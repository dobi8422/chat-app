var W=Object.defineProperty;var b=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var L=(e,t,a)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,p=(e,t)=>{for(var a in t||(t={}))z.call(t,a)&&L(e,a,t[a]);if(b)for(var a of b(t))V.call(t,a)&&L(e,a,t[a]);return e};import{m as v,r as g,o as l,c,a as i,b as m,w as h,T as w,d,e as $,f as P,t as E,g as S,F as G,h as j,p as F,i as H,j as B,k as K,v as Z,l as q,n as D,q as X,s as J,u as Q,x as k,y as Y,z as x}from"./vendor.060da810.js";const ee=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=a(s);fetch(s.href,n)}};ee();var M=(e,t)=>{for(const[a,r]of t)e[a]=r;return e};const te={data:()=>({navDown:!1}),computed:p({isCollapse(){return this.fullWidth<768}},v(["fullWidth"]))},se={class:"nav"},oe=i("i",{class:"far fa-comment-dots fa-lg"},null,-1),ae=$(" Chat App"),ne=[oe,ae],re={key:0},ie=i("i",{class:"far fa-user-circle fa-lg"},null,-1),le=$(" Login"),ce=i("i",{class:"fas fa-user-plus"},null,-1),ue=$(" Register"),de=i("i",{class:"fas fa-bars"},null,-1),pe=[de],me={key:0,class:"option"},he=$("Login"),fe=$("Register");function _e(e,t,a,r,s,n){const o=g("router-link");return l(),c("div",null,[i("div",se,[i("span",{onClick:t[0]||(t[0]=u=>e.navDown=!1)},ne),n.isCollapse?(l(),c("button",{key:1,class:"collapse_button",onClick:t[3]||(t[3]=u=>e.navDown=!e.navDown)},pe)):(l(),c("div",re,[m(o,{to:"/login",onClick:t[1]||(t[1]=u=>e.navDown=!1)},{default:h(()=>[ie,le]),_:1}),m(o,{to:"/register",onClick:t[2]||(t[2]=u=>e.navDown=!1)},{default:h(()=>[ce,ue]),_:1})]))]),m(w,{name:"option"},{default:h(()=>[e.navDown?(l(),c("div",me,[m(o,{to:"/login",onClick:t[4]||(t[4]=u=>e.navDown=!1)},{default:h(()=>[he]),_:1}),m(o,{to:"/register",onClick:t[5]||(t[5]=u=>e.navDown=!1)},{default:h(()=>[fe]),_:1})])):d("",!0)]),_:1})])}var ge=M(te,[["render",_e]]);const ve={computed:p({},v(["message"]))},$e={key:0,class:"message"};function Me(e,t,a,r,s,n){return l(),P(w,{name:"message"},{default:h(()=>[e.message?(l(),c("div",$e,E(e.message),1)):d("",!0)]),_:1})}var Re=M(ve,[["render",Me]]);const Pe={data:()=>({panelDown:!1}),methods:p({},S(["UserProfile"])),computed:p({onlineUser(){return"hi"}},v(["userState"]))},Ee=e=>(F("data-v-10bdeaac"),e=e(),H(),e),ye={key:0,class:"fas fa-chevron-right"},we={key:1,class:"fas fa-chevron-left"},Se={key:0,class:"content"},ke={key:0,class:"title"},Ae=Ee(()=>i("i",{class:"fas fa-signal"},null,-1)),Oe=$(" \u76EE\u524D\u4E0A\u7DDA"),De=[Ae,Oe],Ue=["src","onClick"],be={key:1};function Le(e,t,a,r,s,n){return l(),c("div",null,[i("button",{onClick:t[0]||(t[0]=o=>e.panelDown=!e.panelDown)},[e.panelDown?d("",!0):(l(),c("i",ye)),e.panelDown?(l(),c("i",we)):d("",!0)]),m(w,{name:"panel"},{default:h(()=>[e.panelDown?(l(),c("div",Se,[e.panelDown?(l(),c("p",ke,De)):d("",!0),(l(!0),c(G,null,j(e.userState,o=>(l(),c("div",{class:"onlineUser",key:o.uid},[o.online?(l(),c("img",{key:0,src:o.photoURL,onClick:u=>e.UserProfile(o.user)},null,8,Ue)):d("",!0),o.online?(l(),c("p",be,E(o.user),1)):d("",!0)]))),128))])):d("",!0)]),_:1})])}var Ne=M(Pe,[["render",Le],["__scopeId","data-v-10bdeaac"]]);const Ie={data:()=>({name:""}),methods:p({inputFile(){const e=document.getElementById("input").files[0];this.editProfile(e)}},S(["closeModal","alertMessage","editProfile"])),computed:p({},v(["userName","userProfile"]))},Ce={class:"background"},Te={class:"modal"},We={class:"wrap-0"},ze=i("h5",{class:"title"},"Profile",-1),Ve=i("i",{class:"fas fa-times"},null,-1),Ge=[Ve],je={class:"wrap"},Fe={class:"wrap-1"},He=["src"],Be={key:0},Ke=i("span",null,[i("i",{class:"fas fa-edit"})],-1),Ze={class:"wrap-2"},qe=i("h5",{class:"title name"},"Name",-1),Xe=i("h5",{class:"title"},"Introduction",-1);function Je(e,t,a,r,s,n){return l(),c("div",Ce,[m(w,{name:"modal"},{default:h(()=>[i("div",Te,[i("div",We,[ze,i("button",{onClick:t[0]||(t[0]=(...o)=>e.closeModal&&e.closeModal(...o))},Ge)]),i("div",je,[i("div",Fe,[i("img",{src:e.userProfile[0].photoURL,alt:""},null,8,He),e.userName===e.userProfile[0].user?(l(),c("label",Be,[i("input",{id:"input",type:"file",onChange:t[1]||(t[1]=(...o)=>n.inputFile&&n.inputFile(...o))},null,32),Ke])):d("",!0)]),i("div",Ze,[qe,i("p",null,E(e.userProfile[0].user),1)])]),Xe,i("p",null,E(e.userProfile[0].phoneNumber?e.userProfile[0].phoneNumber:"nothing"),1)])]),_:1})])}var Qe=M(Ie,[["render",Je]]);const Ye={data:()=>({inputPassword:""}),methods:p(p({check(){this.privateDate.password===this.inputPassword?(this.enterRoom(this.privateDate.room),this.alertMessage("Welcome")):this.alertMessage("Wrong password")}},B(["ISPROMPT"])),S(["enterRoom","alertMessage"])),computed:p({},v(["privateDate"]))},xe={class:"background"},et={class:"prompt"},tt={class:"wrap"},st={class:"title"},ot=i("i",{class:"fas fa-times"},null,-1),at=[ot],nt=i("div",{class:"title"},null,-1),rt=["placeholder"],it=i("i",{class:"fas fa-check"},null,-1),lt=[it];function ct(e,t,a,r,s,n){return l(),c("div",xe,[i("div",et,[i("div",tt,[i("h5",st,E(e.privateDate.room),1),i("button",{onClick:t[0]||(t[0]=o=>e.ISPROMPT(!1))},at)]),nt,K(i("input",{type:"text",placeholder:e.privateDate.hint,onKeyup:t[1]||(t[1]=q((...o)=>n.check&&n.check(...o),["enter"])),"onUpdate:modelValue":t[2]||(t[2]=o=>e.inputPassword=o)},null,40,rt),[[Z,e.inputPassword]]),i("button",{class:"check_button",onClick:t[3]||(t[3]=(...o)=>n.check&&n.check(...o))},lt)])])}var ut=M(Ye,[["render",ct]]);const U={apiKey:"AIzaSyAVmhzkedl8VUk3Uw8-aC30zM4pXt2r_Xw",authDomain:"chat-app-29201.firebaseapp.com",databaseURL:"https://chat-app-29201-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"chat-app-29201",storageBucket:"chat-app-29201.appspot.com",messagingSenderId:"840786297605",appId:"1:840786297605:web:4aea95163d2cff23e82d6c"},f=D.initializeApp(U).database(),_=D.initializeApp(U).auth();D.initializeApp(U).storage();const dt={components:{Nav:ge,Message:Re,OnlinePanel:Ne,Modal:Qe,PromptModal:ut},methods:p({onresize(){this.resizeWidth(document.body.clientWidth)}},S(["resizeWidth","UserName","UserState"])),computed:p({},v(["userName","isModal","isPrompt"])),mounted(){window.onresize=()=>{this.onresize()},_.onAuthStateChanged(e=>{e?(this.UserName(e.displayName),this.UserState(),this.$router.push("/choose_chat")):this.$router.push("/login")})}},pt={id:"app"};function mt(e,t,a,r,s,n){const o=g("Nav"),u=g("Message"),R=g("router-view"),O=g("OnlinePanel"),C=g("Modal"),T=g("PromptModal");return l(),c("div",pt,[e.userName?d("",!0):(l(),P(o,{key:0})),m(u),m(R),e.userName?(l(),P(O,{key:1})):d("",!0),e.isModal?(l(),P(C,{key:2})):d("",!0),e.isPrompt?(l(),P(T,{key:3})):d("",!0)])}var ht=M(dt,[["render",mt]]);const ft="modulepreload",N={},_t="/chat-app/",A=function(t,a){return!a||a.length===0?t():Promise.all(a.map(r=>{if(r=`${_t}${r}`,r in N)return;N[r]=!0;const s=r.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${n}`))return;const o=document.createElement("link");if(o.rel=s?"stylesheet":ft,s||(o.as="script",o.crossOrigin=""),o.href=r,document.head.appendChild(o),s)return new Promise((u,R)=>{o.addEventListener("load",u),o.addEventListener("error",R)})})).then(()=>t())},gt=[{path:"/:catchAll(.*)",redirect:"/choose_chat"},{path:"/login",name:"Login",component:()=>A(()=>import("./Login.9a07c0ce.js"),["assets/Login.9a07c0ce.js","assets/vendor.060da810.js"])},{path:"/register",name:"Register",component:()=>A(()=>import("./Register.c06b29aa.js"),["assets/Register.c06b29aa.js","assets/vendor.060da810.js"])},{path:"/choose_chat",name:"ChooseChat",component:()=>A(()=>import("./ChooseChat.4cc360b5.js"),["assets/ChooseChat.4cc360b5.js","assets/ChooseChat.cd4281af.css","assets/vendor.060da810.js"])},{path:"/chat/:chatId",name:"Chat",component:()=>A(()=>import("./Chat.9de2f4b3.js"),["assets/Chat.9de2f4b3.js","assets/Chat.bfea6b74.css","assets/vendor.060da810.js"])}],y=X({history:J(),routes:gt});Q({validateOnInput:!0});k("name",e=>!e||!e.length?"Please enter username":e.length<3||e.length>10?"Must between 3 ~ 10 character":!0);k("email",e=>!e||!e.length?"Please enter email":/^([A-Za-z0-9-.])+@([A-Za-z0-9-.])+.([A-Za-z]{2,4})$/.test(e)?!0:"Wrong email format");k("password",e=>!e||!e.length?"Please enter password":e.length<6||e.length>12?"Must between 6 ~ 12 character":!0);k("confirmed",(e,[t])=>e!==t?"Must be completely consistent":!0);var vt={state:()=>({userName:"",userState:[],lookUserProfile:[]}),actions:{async checkAccount({dispatch:e},t){const{email:a,password:r}=t;let s;try{await _.signInWithEmailAndPassword(a,r).then(n=>{s=n.user.displayName}),e("alertMessage",`Welcom, ${s}`),e("UserName",s),e("UserState"),y.push("/choose_chat")}catch{e("alertMessage",'"Wrong password" or "Email is not yet register"')}},async registerAccount({dispatch:e},t){const{name:a,email:r,password:s}=t;let o=new Date().getMilliseconds();o===394&&(o=395);try{await _.createUserWithEmailAndPassword(r,s),await _.currentUser.updateProfile({displayName:a,photoURL:`https://picsum.photos/id/${o}/200/200`,phoneNumber:"Nothing"}),y.push("/login"),e("alertMessage",`Registration success\uFF1A${a}`)}catch{e("alertMessage","Registration failed")}},UserName({commit:e},t){e("USERNAME",t)},logout({dispatch:e}){_.signOut().then(()=>{e("alertMessage","Sign out"),e("UserName",""),y.push("/login")}).catch(e("alertMessage","Logout failed"))},UserState({commit:e}){const t=_.currentUser,{displayName:a,photoURL:r,uid:s}=t,n=f.ref(`userstate/${s}`);f.ref(".info/connected").on("value",u=>{if(u.val()){const R={user:a,online:!0,photoURL:r},O={user:a,online:!1,photoURL:r};n.onDisconnect().set(O).then(()=>{n.set(R)})}}),f.ref("userstate").on("value",u=>{e("USERSTATE",u.val())})},UserProfile({commit:e,state:t},a){const r=Object.values(t.userState).filter(s=>s.user===a);e("LOOKUSERPROFILE",r),e("ISMODEL",!0)},async editProfile({state:e,dispatch:t},a){t("alertMessage","not yet open")}},mutations:{USERNAME(e,t){e.userName=t},USERSTATE(e,t){e.userState=t},LOOKUSERPROFILE(e,t){e.lookUserProfile=t}},getters:{userName:e=>e.userName,userState:e=>e.userState,userProfile:e=>e.lookUserProfile}},$t={state:()=>({room:"",allRoom:[],allMessages:[],privateRoom:[],privateDate:{}}),actions:{newChat({dispatch:e},t){if(!t)return!0;if(!/^[a-zA-Z0-9_!?~\u4e00-\u9fa5\u0800-\u4e00\xAC00-\xD7A3\x3130-\x318F]+$/.test(t))return e("alertMessage",'only "English", "\u4E2D\u6587" or "_", "!", "?", "~"'),!0;const r=f.ref("chatroom"),s={room:t};r.push(s),e("alertMessage","Added successfully"),e("getRoom")},getRoom({commit:e}){const t=f.ref("chatroom"),a=[];t.on("value",r=>{const s=r.val();Object.keys(s).forEach(n=>{a.push({room:s[n].room})}),e("GETROOM",a)})},enterRoom({commit:e},t){y.push(`/chat/${t}`),e("GETMESSAGES",""),e("ENTERROOM",t),e("ISPROMPT",!1)},enterPrivateRoom({commit:e},t){e("PRIVATEDATA",t),e("ISPROMPT",!0)},getMessages({commit:e,state:t}){const a=f.ref(`message_${t.room}`),r=[];a.on("value",s=>{const n=s.val();Object.keys(n).forEach(o=>{r.push({user:n[o].user,content:n[o].content,time:n[o].time,photoURL:n[o].photoURL,day:n[o].day})}),e("GETMESSAGES",r)})},getPrivateRoom({commit:e}){const t=f.ref("privateroom"),a=[];t.on("value",r=>{const s=r.val();Object.keys(s).forEach(n=>{a.push({room:s[n].room,password:s[n].password,hint:s[n].hint})}),e("GETPRIVATEROOM",a)})},sendMessage({rootState:e,dispatch:t,state:a},r){const s=new Date,n={user:e.accountModule.userName,content:r,time:`${s.getHours()<0?"0"+s.getHours():s.getHours()}:${s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes()}`,photoURL:_.currentUser.photoURL,day:s.getDate()};f.ref(`message_${a.room}`).push(n),t("getMessages",a.room)}},mutations:{GETROOM(e,t){e.allRoom=t},ENTERROOM(e,t){e.room=t},GETMESSAGES(e,t){e.allMessages=t},GETPRIVATEROOM(e,t){e.privateRoom=t},PRIVATEDATA(e,t){e.privateDate=t}},getters:{room:e=>e.room,allRoom:e=>e.allRoom,allMessages:e=>e.allMessages,privateRoom:e=>e.privateRoom,privateDate:e=>e.privateDate}};const Mt=Y({state:()=>({message:"",fullWidth:800,isModal:!1,isPrompt:!1}),actions:{alertMessage({commit:e},t){e("MESSAGE",t),setTimeout(()=>{e("MESSAGE","")},2e3)},resizeWidth({commit:e},t){e("RESIZEWIDTH",t)},closeModal({commit:e}){e("CLEARMODAL"),e("ISMODEL",!1)}},mutations:{MESSAGE(e,t){e.message=t},RESIZEWIDTH(e,t){e.fullWidth=t},ISMODEL(e,t){e.isModal=t},CLEARMODAL(e){e.lookUserProfile=[]},ISPROMPT(e,t){e.isPrompt=t}},getters:{message:e=>e.message,fullWidth:e=>e.fullWidth,isModal:e=>e.isModal,isPrompt:e=>e.isPrompt},modules:{accountModule:vt,chatModule:$t}});let I;_.onAuthStateChanged(()=>{I||(I=x(ht).use(Mt).use(y).mount("#app"))});export{M as _};
