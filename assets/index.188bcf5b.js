var G=Object.defineProperty;var L=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var b=(e,t,o)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,p=(e,t)=>{for(var o in t||(t={}))V.call(t,o)&&b(e,o,t[o]);if(L)for(var o of L(t))j.call(t,o)&&b(e,o,t[o]);return e};import{m as M,r as v,o as l,c,a as i,b as m,w as g,T as N,d as u,e as $,f as S,t as w,g as P,F as H,h as F,p as D,i as C,j as I,k as Z,l as B,n as K,q as A,s as q,u as X}from"./vendor.695f98a6.js";const J=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}};J();var E=(e,t)=>{for(const[o,r]of t)e[o]=r;return e};const Q={data:()=>({navDown:!1}),computed:p({isCollapse(){return this.fullWidth<768}},M(["fullWidth"]))},Y={class:"nav"},x=i("i",{class:"far fa-comment-dots fa-lg"},null,-1),ee=$(" Chat App"),te=[x,ee],se={key:0},oe=i("i",{class:"far fa-user-circle fa-lg"},null,-1),ne=$(" Login"),ae=i("i",{class:"fas fa-user-plus"},null,-1),re=$(" Register"),ie=i("i",{class:"fas fa-bars"},null,-1),le=[ie],ce={key:0,class:"option"},ue=$("Login"),de=$("Register");function pe(e,t,o,r,s,a){const n=v("router-link");return l(),c("div",null,[i("div",Y,[i("span",{onClick:t[0]||(t[0]=d=>e.navDown=!1)},te),a.isCollapse?(l(),c("button",{key:1,class:"collapse_button",onClick:t[3]||(t[3]=d=>e.navDown=!e.navDown)},le)):(l(),c("div",se,[m(n,{to:"/login",onClick:t[1]||(t[1]=d=>e.navDown=!1)},{default:g(()=>[oe,ne]),_:1}),m(n,{to:"/register",onClick:t[2]||(t[2]=d=>e.navDown=!1)},{default:g(()=>[ae,re]),_:1})]))]),m(N,{name:"option"},{default:g(()=>[e.navDown?(l(),c("div",ce,[m(n,{to:"/login",onClick:t[4]||(t[4]=d=>e.navDown=!1)},{default:g(()=>[ue]),_:1}),m(n,{to:"/register",onClick:t[5]||(t[5]=d=>e.navDown=!1)},{default:g(()=>[de]),_:1})])):u("",!0)]),_:1})])}var me=E(Q,[["render",pe]]);const he={computed:p({},M(["message"]))},fe={key:0,class:"message"};function _e(e,t,o,r,s,a){return l(),S(N,{name:"message"},{default:g(()=>[e.message?(l(),c("div",fe,w(e.message),1)):u("",!0)]),_:1})}var ge=E(he,[["render",_e]]);const ve={data:()=>({panelDown:!1}),methods:p({},P(["UserProfile"])),computed:p({onlineUser(){return"hi"}},M(["userState"]))},$e=e=>(D("data-v-e644aece"),e=e(),C(),e),Me={key:0,class:"fas fa-chevron-right"},Ee={key:1,class:"fas fa-chevron-left"},Re={key:0,class:"content"},ye={key:0,class:"title"},Se=$e(()=>i("i",{class:"fas fa-signal"},null,-1)),we=$(" \u76EE\u524D\u4E0A\u7DDA"),Ae=[Se,we],Oe=["src","onClick"],Ue={key:1};function ke(e,t,o,r,s,a){return l(),c("div",null,[i("button",{onClick:t[0]||(t[0]=n=>e.panelDown=!e.panelDown)},[e.panelDown?u("",!0):(l(),c("i",Me)),e.panelDown?(l(),c("i",Ee)):u("",!0)]),m(N,{name:"panel"},{default:g(()=>[e.panelDown?(l(),c("div",Re,[e.panelDown?(l(),c("p",ye,Ae)):u("",!0),(l(!0),c(H,null,F(e.userState,n=>(l(),c("div",{class:"onlineUser",key:n.uid},[n.online?(l(),c("img",{key:0,src:n.photoURL,onClick:d=>e.UserProfile(n.user)},null,8,Oe)):u("",!0),n.online?(l(),c("p",Ue,w(n.user),1)):u("",!0)]))),128))])):u("",!0)]),_:1})])}var Ne=E(ve,[["render",ke],["__scopeId","data-v-e644aece"]]);const Pe={data:()=>({name:""}),methods:p({},P(["closeModal","alertMessage"])),computed:p({},M(["userName","userProfile"]))},R=e=>(D("data-v-2923f97c"),e=e(),C(),e),Le={class:"background"},be={class:"modal"},De={class:"wrap-0"},Ce=R(()=>i("h5",{class:"title"},"Profile",-1)),Ie=R(()=>i("i",{class:"fas fa-times"},null,-1)),Te=[Ie],We={class:"wrap"},ze={class:"wrap-1"},Ge=["src"],Ve={key:0},je=R(()=>i("span",null,[i("i",{class:"fas fa-edit"})],-1)),He={class:"wrap-2"},Fe=R(()=>i("h5",{class:"title name"},"Name",-1)),Ze=R(()=>i("h5",{class:"title"},"Introduction",-1));function Be(e,t,o,r,s,a){return l(),c("div",Le,[i("div",be,[i("div",De,[Ce,i("button",{onClick:t[0]||(t[0]=(...n)=>e.closeModal&&e.closeModal(...n))},Te)]),i("div",We,[i("div",ze,[i("img",{src:e.userProfile[0].photoURL,alt:""},null,8,Ge),e.userName===e.userProfile[0].user?(l(),c("label",Ve,[i("input",{type:"file",onChange:t[1]||(t[1]=n=>e.alertMessage("not yet open"))},null,32),je])):u("",!0)]),i("div",He,[Fe,i("p",null,w(e.userProfile[0].user),1)])]),Ze,i("p",null,w(e.userProfile[0].phoneNumber?e.userProfile[0].phoneNumber:"There is nothing"),1)])])}var Ke=E(Pe,[["render",Be],["__scopeId","data-v-2923f97c"]]);const T={apiKey:"AIzaSyAVmhzkedl8VUk3Uw8-aC30zM4pXt2r_Xw",authDomain:"chat-app-29201.firebaseapp.com",databaseURL:"https://chat-app-29201-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"chat-app-29201",storageBucket:"chat-app-29201.appspot.com",messagingSenderId:"840786297605",appId:"1:840786297605:web:4aea95163d2cff23e82d6c"},h=I.initializeApp(T).database(),f=I.initializeApp(T).auth();const qe={components:{Nav:me,Message:ge,OnlinePanel:Ne,Modal:Ke},methods:p({onresize(){this.resizeWidth(document.body.clientWidth)}},P(["resizeWidth","UserName","UserState"])),computed:p({},M(["userName","isModal"])),mounted(){window.onresize=()=>{this.onresize()},f.onAuthStateChanged(e=>{e?(this.UserName(e.displayName),this.UserState(),this.$router.push("/choose_chat")):this.$router.push("/login")})}},Xe={id:"app"};function Je(e,t,o,r,s,a){const n=v("Nav"),d=v("Message"),_=v("router-view"),U=v("OnlinePanel"),k=v("Modal");return l(),c("div",Xe,[e.userName?u("",!0):(l(),S(n,{key:0})),m(d),m(_),e.userName?(l(),S(U,{key:1})):u("",!0),e.isModal?(l(),S(k,{key:2})):u("",!0)])}var Qe=E(qe,[["render",Je]]);const Ye="modulepreload",W={},xe="/chat-app/",O=function(t,o){return!o||o.length===0?t():Promise.all(o.map(r=>{if(r=`${xe}${r}`,r in W)return;W[r]=!0;const s=r.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${a}`))return;const n=document.createElement("link");if(n.rel=s?"stylesheet":Ye,s||(n.as="script",n.crossOrigin=""),n.href=r,document.head.appendChild(n),s)return new Promise((d,_)=>{n.addEventListener("load",d),n.addEventListener("error",_)})})).then(()=>t())},et=[{path:"/:catchAll(.*)",redirect:"/choose_chat"},{path:"/login",name:"Login",component:()=>O(()=>import("./Login.4ce6b0cd.js"),["assets/Login.4ce6b0cd.js","assets/vendor.695f98a6.js"])},{path:"/register",name:"Register",component:()=>O(()=>import("./Register.7c4790cf.js"),["assets/Register.7c4790cf.js","assets/vendor.695f98a6.js"])},{path:"/choose_chat",name:"ChooseChat",component:()=>O(()=>import("./ChooseChat.d8d68f5e.js"),["assets/ChooseChat.d8d68f5e.js","assets/ChooseChat.cd4281af.css","assets/vendor.695f98a6.js"])},{path:"/chat/:chatId",name:"Chat",component:()=>O(()=>import("./Chat.2b310482.js"),["assets/Chat.2b310482.js","assets/Chat.bfea6b74.css","assets/vendor.695f98a6.js"])}],y=Z({history:B(),routes:et});K({validateOnInput:!0});A("name",e=>!e||!e.length?"Please enter username":e.length<3||e.length>10?"Must between 3 ~ 10 character":!0);A("email",e=>!e||!e.length?"Please enter email":/^([A-Za-z0-9-.])+@([A-Za-z0-9-.])+.([A-Za-z]{2,4})$/.test(e)?!0:"Wrong email format");A("password",e=>!e||!e.length?"Please enter password":e.length<6||e.length>12?"Must between 6 ~ 12 character":!0);A("confirmed",(e,[t])=>e!==t?"Must be completely consistent":!0);var tt={state:()=>({userName:"",userState:[],lookUserProfile:[]}),actions:{async checkAccount({dispatch:e},t){const{email:o,password:r}=t;let s;try{await f.signInWithEmailAndPassword(o,r).then(a=>{s=a.user.displayName}),e("alertMessage",`Welcom, ${s}`),e("UserName",s),e("UserState"),y.push("/choose_chat")}catch{e("alertMessage",'"Wrong password" or "Email is not yet register"')}},async registerAccount({dispatch:e},t){const{name:o,email:r,password:s}=t,n=new Date().getMilliseconds();try{await f.createUserWithEmailAndPassword(r,s),await f.currentUser.updateProfile({displayName:o,photoURL:`https://picsum.photos/id/${n}/200/200`,phoneNumber:"nothing"}),y.push("/login"),e("alertMessage",`Registration success\uFF1A${o}`)}catch{e("alertMessage","Registration failed")}},UserName({commit:e},t){e("USERNAME",t)},logout({dispatch:e}){f.signOut().then(()=>{e("alertMessage","Sign out"),e("UserName",""),y.push("/login")}).catch(e("alertMessage","Logout failed"))},UserState({commit:e}){const t=f.currentUser,{displayName:o,photoURL:r,uid:s,phoneNumber:a}=t,n=h.ref(`userstate/${s}`);h.ref(".info/connected").on("value",_=>{if(_.val()){const U={user:o,online:!0,photoURL:r,phoneNumber:a},k={user:o,online:!1,photoURL:r,phoneNumber:a};n.onDisconnect().set(k).then(()=>{n.set(U)})}}),h.ref("userstate").on("value",_=>{e("USERSTATE",_.val())})},UserProfile({commit:e,state:t},o){const r=Object.values(t.userState).filter(s=>s.user===o);e("LOOKUSERPROFILE",r),e("ISMODEL",!0)}},mutations:{USERNAME(e,t){e.userName=t},USERSTATE(e,t){e.userState=t},LOOKUSERPROFILE(e,t){e.lookUserProfile=t}},getters:{userName:e=>e.userName,userState:e=>e.userState,userProfile:e=>e.lookUserProfile}},st={state:()=>({room:"",allRoom:[],allMessages:[],privateRoom:[]}),actions:{newChat({dispatch:e},t){if(!t)return!0;if(!/^[a-zA-Z0-9_!?~\u4e00-\u9fa5\u0800-\u4e00\xAC00-\xD7A3\x3130-\x318F]+$/.test(t))return e("alertMessage",'only "English", "\u4E2D\u6587" or "_", "!", "?", "~"'),!0;const r=h.ref("chatroom"),s={room:t};r.push(s),e("alertMessage","Added successfully"),e("getRoom")},getRoom({commit:e}){const t=h.ref("chatroom"),o=[];t.on("value",r=>{const s=r.val();Object.keys(s).forEach(a=>{o.push({room:s[a].room})}),e("GETROOM",o)})},enterRoom({commit:e},t){y.push(`/chat/${t}`),e("GETMESSAGES",""),e("ENTERROOM",t)},sendMessage({rootState:e,dispatch:t,state:o},r){const s=new Date,a={user:e.accountModule.userName,content:r,time:`${s.getHours()<0?"0"+s.getHours():s.getHours()}:${s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes()}`,photoURL:f.currentUser.photoURL,day:s.getDate()};h.ref(`message_${o.room}`).push(a),t("getMessages",o.room)},getMessages({commit:e,state:t}){const o=h.ref(`message_${t.room}`),r=[];o.on("value",s=>{const a=s.val();Object.keys(a).forEach(n=>{r.push({user:a[n].user,content:a[n].content,time:a[n].time,photoURL:a[n].photoURL,day:a[n].day})}),e("GETMESSAGES",r)})},getPrivateRoom({commit:e}){const t=h.ref("privateroom"),o=[];t.on("value",r=>{const s=r.val();Object.keys(s).forEach(a=>{o.push({room:s[a].room,password:s[a].password,hint:s[a].hint})}),e("GETPRIVATEROOM",o)})}},mutations:{GETROOM(e,t){e.allRoom=t},ENTERROOM(e,t){e.room=t},GETMESSAGES(e,t){e.allMessages=t},GETPRIVATEROOM(e,t){e.privateRoom=t}},getters:{room:e=>e.room,allRoom:e=>e.allRoom,allMessages:e=>e.allMessages,privateRoom:e=>e.privateRoom}};const ot=q({state:()=>({message:"",fullWidth:800,isModal:!1}),actions:{alertMessage({commit:e},t){e("MESSAGE",t),setTimeout(()=>{e("MESSAGE","")},2e3)},resizeWidth({commit:e},t){e("RESIZEWIDTH",t)},closeModal({commit:e}){e("CLEARMODAL"),e("ISMODEL",!1)}},mutations:{MESSAGE(e,t){e.message=t},RESIZEWIDTH(e,t){e.fullWidth=t},ISMODEL(e,t){e.isModal=t},CLEARMODAL(e){e.lookUserProfile=[]}},getters:{message:e=>e.message,fullWidth:e=>e.fullWidth,isModal:e=>e.isModal},modules:{accountModule:tt,chatModule:st}});let z;f.onAuthStateChanged(()=>{z||(z=X(Qe).use(ot).use(y).mount("#app"))});export{E as _};
